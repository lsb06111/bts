<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container my-5" style="max-width:1200px;">

  <!-- ì „ì²´ ì¹´ë“œ ë°•ìŠ¤ -->
  <div style="
        background-color:#fff;
        border-radius:16px;
        box-shadow:0 4px 18px rgba(0,0,0,0.08);
        padding:20px 30px;
        width:100%;
    ">

    <!-- í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-5">
      <h2 style="font-weight:700; color:#333;">
        <span style="color:#696cff;">${loginUser.ename} ${loginUser.job.jname}</span>ë‹˜, ë°˜ê°‘ìŠµë‹ˆë‹¤ ğŸ˜Š
      </h2>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="row g-4">
      <!-- ì¢Œì¸¡: ê·¸ë˜í”„ -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100" style="border:none; border-radius:15px;">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h6 style="font-weight:600; color:#333;">í”„ë¡œì íŠ¸1 ë°°í¬ ì„±ê³µë¥ </h6>
              <select class="form-select form-select-sm" style="width:auto; border-radius:8px;">
                <option>í”„ë¡œì íŠ¸1</option>
              </select>
            </div>
            <p class="text-muted" style="font-size:0.9rem;">ì§€ë‚œ ë‹¬ ë°°í¬ ì„±ê³µë¥ </p>
            <canvas id="deployChart" style="max-width:200px; margin:auto;"></canvas>
            <h3 class="text-center mt-3" style="font-weight:700; color:#696cff;">85%</h3>
          </div>
        </div>
      </div>

      <!-- ìš°ì¸¡: ìµœì‹  ê³µì§€ì‚¬í•­ -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100" style="border:none; border-radius:15px;">
          <div class="card-body">
            <h6 style="font-weight:600; color:#333; margin-bottom:15px;">ìµœì‹  ê³µì§€ì‚¬í•­</h6>
            <table class="table align-middle mb-0" style="font-size:0.9rem;">
              <thead style="background-color:#f8f9fc;">
                <tr style="color:#555; font-weight:600;">
                  <th>ë²ˆí˜¸</th><th>ì œëª©</th><th>ë“±ë¡ ë¶€ì„œ</th><th>ë‚ ì§œ</th>
                </tr>
              </thead>
              <tbody>
                <c:forEach var="notice" items="${latestNotice}">
                  <tr style="border-bottom:1px solid #f1f1f1;">
                    <td style="color:#666;">${notice.id}</td>
                    <td>
                      <a href="/bts/notice/view?id=${notice.id}"
                         style="text-decoration:none; color:#222; font-weight:500;">
                        ${notice.title}
                      </a>
                    </td>
                    <td style="color:#696cff; font-weight:600;">${notice.dname}</td>
                    <td style="color:#777;">${notice.createdAt}</td>
                  </tr>
                </c:forEach>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨: ìµœê·¼ ë°°í¬ ì‹ ì²­/ë‹µë³€ ëŒ€ê¸° ëª©ë¡ -->
    <div class="mt-5">
      <%@ include file="/WEB-INF/views/jspf/main/latestRequests.jspf" %> 
    </div>

  </div><!-- // ë©”ì¸ ë°•ìŠ¤ ë -->

</div>

<!-- Chart.js -->
<script>
const ctx = document.getElementById('deployChart');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['ì„±ê³µ', 'ì‹¤íŒ¨'],
    datasets: [{
      data: [85, 15],
      backgroundColor: ['#696cff', '#dee2e6']
    }]
  },
  options: {
    plugins: {
      legend: {
        position: 'bottom',
        labels: { boxWidth: 12, color: '#333', font: { size: 13 } }
      }
    },
    cutout: '70%'
  }
});
</script>